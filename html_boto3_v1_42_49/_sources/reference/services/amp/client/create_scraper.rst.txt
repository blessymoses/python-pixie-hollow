:doc:`PrometheusService <../../amp>` / Client / create_scraper

**************
create_scraper
**************



.. py:method:: PrometheusService.Client.create_scraper(**kwargs)

  

  The ``CreateScraper`` operation creates a scraper to collect metrics. A scraper pulls metrics from Prometheus-compatible sources and sends them to your Amazon Managed Service for Prometheus workspace. You can configure scrapers to collect metrics from Amazon EKS clusters, Amazon MSK clusters, or from VPC-based sources that support DNS-based service discovery. Scrapers are flexible, and can be configured to control what metrics are collected, the frequency of collection, what transformations are applied to the metrics, and more.

   

  An IAM role will be created for you that Amazon Managed Service for Prometheus uses to access the metrics in your source. You must configure this role with a policy that allows it to scrape metrics from your source. For Amazon EKS sources, see `Configuring your Amazon EKS cluster <https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-collector-how-to.html#AMP-collector-eks-setup>`__ in the *Amazon Managed Service for Prometheus User Guide*.

   

  The ``scrapeConfiguration`` parameter contains the base-64 encoded YAML configuration for the scraper.

   

  When creating a scraper, the service creates a ``Network Interface`` in each **Availability Zone** that are passed into ``CreateScraper`` through subnets. These network interfaces are used to connect to your source within the VPC for scraping metrics.

   

  .. note::

    

    For more information about collectors, including what metrics are collected, and how to configure the scraper, see `Using an Amazon Web Services managed collector <https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-collector-how-to.html>`__ in the *Amazon Managed Service for Prometheus User Guide*.

    

  

  See also: `AWS API Documentation <https://docs.aws.amazon.com/goto/WebAPI/amp-2020-08-01/CreateScraper>`_  


  **Request Syntax**
  ::

    response = client.create_scraper(
        alias='string',
        scrapeConfiguration={
            'configurationBlob': b'bytes'
        },
        source={
            'eksConfiguration': {
                'clusterArn': 'string',
                'securityGroupIds': [
                    'string',
                ],
                'subnetIds': [
                    'string',
                ]
            },
            'vpcConfiguration': {
                'securityGroupIds': [
                    'string',
                ],
                'subnetIds': [
                    'string',
                ]
            }
        },
        destination={
            'ampConfiguration': {
                'workspaceArn': 'string'
            }
        },
        roleConfiguration={
            'sourceRoleArn': 'string',
            'targetRoleArn': 'string'
        },
        clientToken='string',
        tags={
            'string': 'string'
        }
    )
    
  :type alias: string
  :param alias: 

    (optional) An alias to associate with the scraper. This is for your use, and does not need to be unique.

    

  
  :type scrapeConfiguration: dict
  :param scrapeConfiguration: **[REQUIRED]** 

    The configuration file to use in the new scraper. For more information, see `Scraper configuration <https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-collector-how-to.html#AMP-collector-configuration>`__ in the *Amazon Managed Service for Prometheus User Guide*.

    .. note::    This is a Tagged Union structure. Only one of the     following top level keys can be set: ``configurationBlob``. 

  
    - **configurationBlob** *(bytes) --* 

      The base 64 encoded scrape configuration file.

      

    
  
  :type source: dict
  :param source: **[REQUIRED]** 

    The Amazon EKS or Amazon Web Services cluster from which the scraper will collect metrics.

    .. note::    This is a Tagged Union structure. Only one of the     following top level keys can be set: ``eksConfiguration``, ``vpcConfiguration``. 

  
    - **eksConfiguration** *(dict) --* 

      The Amazon EKS cluster from which a scraper collects metrics.

      

    
      - **clusterArn** *(string) --* **[REQUIRED]** 

        ARN of the Amazon EKS cluster.

        

      
      - **securityGroupIds** *(list) --* 

        A list of the security group IDs for the Amazon EKS cluster VPC configuration.

        

      
        - *(string) --* 

          ID of a VPC security group.

          

        
    
      - **subnetIds** *(list) --* **[REQUIRED]** 

        A list of subnet IDs for the Amazon EKS cluster VPC configuration.

        

      
        - *(string) --* 

          ID of a VPC subnet.

          

        
    
    
    - **vpcConfiguration** *(dict) --* 

      The Amazon VPC configuration for the Prometheus collector when connecting to Amazon MSK clusters. This configuration enables secure, private network connectivity between the collector and your Amazon MSK cluster within your Amazon VPC.

      

    
      - **securityGroupIds** *(list) --* **[REQUIRED]** 

        The security group IDs that control network access for the Prometheus collector. These security groups must allow the collector to communicate with your Amazon MSK cluster on the required ports.

        

      
        - *(string) --* 

          ID of a VPC security group.

          

        
    
      - **subnetIds** *(list) --* **[REQUIRED]** 

        The subnet IDs where the Prometheus collector will be deployed. The subnets must be in the same Amazon VPC as your Amazon MSK cluster and have network connectivity to the cluster.

        

      
        - *(string) --* 

          ID of a VPC subnet.

          

        
    
    
  
  :type destination: dict
  :param destination: **[REQUIRED]** 

    The Amazon Managed Service for Prometheus workspace to send metrics to.

    .. note::    This is a Tagged Union structure. Only one of the     following top level keys can be set: ``ampConfiguration``. 

  
    - **ampConfiguration** *(dict) --* 

      The Amazon Managed Service for Prometheus workspace to send metrics to.

      

    
      - **workspaceArn** *(string) --* **[REQUIRED]** 

        ARN of the Amazon Managed Service for Prometheus workspace.

        

      
    
  
  :type roleConfiguration: dict
  :param roleConfiguration: 

    Use this structure to enable cross-account access, so that you can use a target account to access Prometheus metrics from source accounts.

    

  
    - **sourceRoleArn** *(string) --* 

      The Amazon Resource Name (ARN) of the role used in the source account to enable cross-account scraping. For information about the contents of this policy, see `Cross-account setup <https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-collector-how-to.html#cross-account-remote-write>`__.

      

    
    - **targetRoleArn** *(string) --* 

      The Amazon Resource Name (ARN) of the role used in the target account to enable cross-account scraping. For information about the contents of this policy, see `Cross-account setup <https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-collector-how-to.html#cross-account-remote-write>`__.

      

    
  
  :type clientToken: string
  :param clientToken: 

    (Optional) A unique, case-sensitive identifier that you can provide to ensure the idempotency of the request.

    This field is autopopulated if not provided.

  
  :type tags: dict
  :param tags: 

    (Optional) The list of tag keys and values to associate with the scraper.

    

  
    - *(string) --* 

      The key of the tag. Must not begin with ``aws:``.

      

    
      - *(string) --* 

        The value of the tag.

        

      


  
  :rtype: dict
  :returns: 
    
    **Response Syntax**

    
    ::

      {
          'scraperId': 'string',
          'arn': 'string',
          'status': {
              'statusCode': 'CREATING'|'UPDATING'|'ACTIVE'|'DELETING'|'CREATION_FAILED'|'UPDATE_FAILED'|'DELETION_FAILED'
          },
          'tags': {
              'string': 'string'
          }
      }
      
    **Response Structure**

    

    - *(dict) --* 

      Represents the output of a ``CreateScraper`` operation.

      
      

      - **scraperId** *(string) --* 

        The ID of the new scraper.

        
      

      - **arn** *(string) --* 

        The Amazon Resource Name (ARN) of the new scraper.

        
      

      - **status** *(dict) --* 

        A structure that displays the current status of the scraper.

        
        

        - **statusCode** *(string) --* 

          The current status of the scraper.

          
    
      

      - **tags** *(dict) --* 

        The list of tag keys and values that are associated with the scraper.

        
        

        - *(string) --* 

          The key of the tag. Must not begin with ``aws:``.

          
          

          - *(string) --* 

            The value of the tag.

            
    
  
  
  **Exceptions**
  
  *   :py:class:`PrometheusService.Client.exceptions.ThrottlingException`

  
  *   :py:class:`PrometheusService.Client.exceptions.ConflictException`

  
  *   :py:class:`PrometheusService.Client.exceptions.ValidationException`

  
  *   :py:class:`PrometheusService.Client.exceptions.ResourceNotFoundException`

  
  *   :py:class:`PrometheusService.Client.exceptions.AccessDeniedException`

  
  *   :py:class:`PrometheusService.Client.exceptions.InternalServerException`

  
  *   :py:class:`PrometheusService.Client.exceptions.ServiceQuotaExceededException`

  