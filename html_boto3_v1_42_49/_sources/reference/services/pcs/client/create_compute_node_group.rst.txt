:doc:`ParallelComputingService <../../pcs>` / Client / create_compute_node_group

*************************
create_compute_node_group
*************************



.. py:method:: ParallelComputingService.Client.create_compute_node_group(**kwargs)

  

  Creates a managed set of compute nodes. You associate a compute node group with a cluster through 1 or more PCS queues or as part of the login fleet. A compute node group includes the definition of the compute properties and lifecycle management. PCS uses the information you provide to this API action to launch compute nodes in your account. You can only specify subnets in the same Amazon VPC as your cluster. You receive billing charges for the compute nodes that PCS launches in your account. You must already have a launch template before you call this API. For more information, see `Launch an instance from a launch template <https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-launch-templates.html>`__ in the *Amazon Elastic Compute Cloud User Guide for Linux Instances*.

  

  See also: `AWS API Documentation <https://docs.aws.amazon.com/goto/WebAPI/pcs-2023-02-10/CreateComputeNodeGroup>`_  


  **Request Syntax**
  ::

    response = client.create_compute_node_group(
        clusterIdentifier='string',
        computeNodeGroupName='string',
        amiId='string',
        subnetIds=[
            'string',
        ],
        purchaseOption='ONDEMAND'|'SPOT'|'CAPACITY_BLOCK',
        customLaunchTemplate={
            'id': 'string',
            'version': 'string'
        },
        iamInstanceProfileArn='string',
        scalingConfiguration={
            'minInstanceCount': 123,
            'maxInstanceCount': 123
        },
        instanceConfigs=[
            {
                'instanceType': 'string'
            },
        ],
        spotOptions={
            'allocationStrategy': 'lowest-price'|'capacity-optimized'|'price-capacity-optimized'
        },
        slurmConfiguration={
            'slurmCustomSettings': [
                {
                    'parameterName': 'string',
                    'parameterValue': 'string'
                },
            ]
        },
        clientToken='string',
        tags={
            'string': 'string'
        }
    )
    
  :type clusterIdentifier: string
  :param clusterIdentifier: **[REQUIRED]** 

    The name or ID of the cluster to create a compute node group in.

    

  
  :type computeNodeGroupName: string
  :param computeNodeGroupName: **[REQUIRED]** 

    A name to identify the cluster. Example: ``MyCluster``

    

  
  :type amiId: string
  :param amiId: 

    The ID of the Amazon Machine Image (AMI) that PCS uses to launch compute nodes (Amazon EC2 instances). If you don't provide this value, PCS uses the AMI ID specified in the custom launch template.

    

  
  :type subnetIds: list
  :param subnetIds: **[REQUIRED]** 

    The list of subnet IDs where the compute node group launches instances. Subnets must be in the same VPC as the cluster.

    

  
    - *(string) --* 

    

  :type purchaseOption: string
  :param purchaseOption: 

    Specifies how EC2 instances are purchased on your behalf. PCS supports On-Demand Instances, Spot Instances, and Amazon EC2 Capacity Blocks for ML. For more information, see `Amazon EC2 billing and purchasing options <https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-purchasing-options.html>`__ in the *Amazon Elastic Compute Cloud User Guide*. For more information about PCS support for Capacity Blocks, see `Using Amazon EC2 Capacity Blocks for ML with PCS <https://docs.aws.amazon.com/pcs/latest/userguide/capacity-blocks.html>`__ in the *PCS User Guide*. If you don't provide this option, it defaults to On-Demand.

    

  
  :type customLaunchTemplate: dict
  :param customLaunchTemplate: **[REQUIRED]** 

    An Amazon EC2 launch template PCS uses to launch compute nodes.

    

  
    - **id** *(string) --* **[REQUIRED]** 

      The ID of the EC2 launch template to use to provision instances.

       

      Example: ``lt-xxxx``

      

    
    - **version** *(string) --* **[REQUIRED]** 

      The version of the EC2 launch template to use to provision instances.

      

    
  
  :type iamInstanceProfileArn: string
  :param iamInstanceProfileArn: **[REQUIRED]** 

    The Amazon Resource Name (ARN) of the IAM instance profile used to pass an IAM role when launching EC2 instances. The role contained in your instance profile must have the ``pcs:RegisterComputeNodeGroupInstance`` permission and the role name must start with ``AWSPCS`` or must have the path ``/aws-pcs/``. For more information, see `IAM instance profiles for PCS <https://docs.aws.amazon.com/pcs/latest/userguide/security-instance-profiles.html>`__ in the *PCS User Guide*.

    

  
  :type scalingConfiguration: dict
  :param scalingConfiguration: **[REQUIRED]** 

    Specifies the boundaries of the compute node group auto scaling.

    

  
    - **minInstanceCount** *(integer) --* **[REQUIRED]** 

      The lower bound of the number of instances allowed in the compute fleet.

      

    
    - **maxInstanceCount** *(integer) --* **[REQUIRED]** 

      The upper bound of the number of instances allowed in the compute fleet.

      

    
  
  :type instanceConfigs: list
  :param instanceConfigs: **[REQUIRED]** 

    A list of EC2 instance configurations that PCS can provision in the compute node group.

    

  
    - *(dict) --* 

      An EC2 instance configuration PCS uses to launch compute nodes.

      

    
      - **instanceType** *(string) --* 

        The EC2 instance type that PCS can provision in the compute node group.

         

        Example: ``t2.xlarge``

        

      
    

  :type spotOptions: dict
  :param spotOptions: 

    Additional configuration when you specify ``SPOT`` as the ``purchaseOption`` for the ``CreateComputeNodeGroup`` API action.

    

  
    - **allocationStrategy** *(string) --* 

      The Amazon EC2 allocation strategy PCS uses to provision EC2 instances. PCS supports **lowest price**, **capacity optimized**, and **price capacity optimized**. For more information, see `Use allocation strategies to determine how EC2 Fleet or Spot Fleet fulfills Spot and On-Demand capacity <https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/spot-fleet-allocation-strategy.html>`__ in the *Amazon Elastic Compute Cloud User Guide*. If you don't provide this option, it defaults to **price capacity optimized**.

      

    
  
  :type slurmConfiguration: dict
  :param slurmConfiguration: 

    Additional options related to the Slurm scheduler.

    

  
    - **slurmCustomSettings** *(list) --* 

      Additional Slurm-specific configuration that directly maps to Slurm settings.

      

    
      - *(dict) --* 

        Additional settings that directly map to Slurm settings.

         

        .. warning::

           

          PCS supports a subset of Slurm settings. For more information, see `Configuring custom Slurm settings in PCS <https://docs.aws.amazon.com/pcs/latest/userguide/slurm-custom-settings.html>`__ in the *PCS User Guide*.

          

        

      
        - **parameterName** *(string) --* **[REQUIRED]** 

          PCS supports custom Slurm settings for clusters, compute node groups, and queues. For more information, see `Configuring custom Slurm settings in PCS <https://docs.aws.amazon.com/pcs/latest/userguide/slurm-custom-settings.html>`__ in the *PCS User Guide*.

          

        
        - **parameterValue** *(string) --* **[REQUIRED]** 

          The values for the configured Slurm settings.

          

        
      
  
  
  :type clientToken: string
  :param clientToken: 

    A unique, case-sensitive identifier that you provide to ensure the idempotency of the request. Idempotency ensures that an API request completes only once. With an idempotent request, if the original request completes successfully, the subsequent retries with the same client token return the result from the original successful request and they have no additional effect. If you don't specify a client token, the CLI and SDK automatically generate 1 for you.

    This field is autopopulated if not provided.

  
  :type tags: dict
  :param tags: 

    1 or more tags added to the resource. Each tag consists of a tag key and tag value. The tag value is optional and can be an empty string.

    

  
    - *(string) --* 

    
      - *(string) --* 

      


  
  :rtype: dict
  :returns: 
    
    **Response Syntax**

    
    ::

      {
          'computeNodeGroup': {
              'name': 'string',
              'id': 'string',
              'arn': 'string',
              'clusterId': 'string',
              'createdAt': datetime(2015, 1, 1),
              'modifiedAt': datetime(2015, 1, 1),
              'status': 'CREATING'|'ACTIVE'|'UPDATING'|'DELETING'|'CREATE_FAILED'|'DELETE_FAILED'|'UPDATE_FAILED'|'DELETED'|'SUSPENDING'|'SUSPENDED'|'RESUMING',
              'amiId': 'string',
              'subnetIds': [
                  'string',
              ],
              'purchaseOption': 'ONDEMAND'|'SPOT'|'CAPACITY_BLOCK',
              'customLaunchTemplate': {
                  'id': 'string',
                  'version': 'string'
              },
              'iamInstanceProfileArn': 'string',
              'scalingConfiguration': {
                  'minInstanceCount': 123,
                  'maxInstanceCount': 123
              },
              'instanceConfigs': [
                  {
                      'instanceType': 'string'
                  },
              ],
              'spotOptions': {
                  'allocationStrategy': 'lowest-price'|'capacity-optimized'|'price-capacity-optimized'
              },
              'slurmConfiguration': {
                  'slurmCustomSettings': [
                      {
                          'parameterName': 'string',
                          'parameterValue': 'string'
                      },
                  ]
              },
              'errorInfo': [
                  {
                      'code': 'string',
                      'message': 'string'
                  },
              ]
          }
      }
      
    **Response Structure**

    

    - *(dict) --* 
      

      - **computeNodeGroup** *(dict) --* 

        A compute node group associated with a cluster.

        
        

        - **name** *(string) --* 

          The name that identifies the compute node group.

          
        

        - **id** *(string) --* 

          The generated unique ID of the compute node group.

          
        

        - **arn** *(string) --* 

          The unique Amazon Resource Name (ARN) of the compute node group.

          
        

        - **clusterId** *(string) --* 

          The ID of the cluster of the compute node group.

          
        

        - **createdAt** *(datetime) --* 

          The date and time the resource was created.

          
        

        - **modifiedAt** *(datetime) --* 

          The date and time the resource was modified.

          
        

        - **status** *(string) --* 

          The provisioning status of the compute node group.

           

          .. note::

            

            The provisioning status doesn't indicate the overall health of the compute node group.

            

           

          .. warning::

             

            The resource enters the ``SUSPENDING`` and ``SUSPENDED`` states when the scheduler is beyond end of life and we have suspended the cluster. When in these states, you can't use the cluster. The cluster controller is down and all compute instances are terminated. The resources still count toward your service quotas. You can delete a resource if its status is ``SUSPENDED``. For more information, see `Frequently asked questions about Slurm versions in PCS <https://docs.aws.amazon.com/pcs/latest/userguide/slurm-versions_faq.html>`__ in the *PCS User Guide*.

            

          
        

        - **amiId** *(string) --* 

          The ID of the Amazon Machine Image (AMI) that PCS uses to launch instances. If not provided, PCS uses the AMI ID specified in the custom launch template.

          
        

        - **subnetIds** *(list) --* 

          The list of subnet IDs where instances are provisioned by the compute node group. The subnets must be in the same VPC as the cluster.

          
          

          - *(string) --* 
      
        

        - **purchaseOption** *(string) --* 

          Specifies how EC2 instances are purchased on your behalf. PCS supports On-Demand Instances, Spot Instances, and Amazon EC2 Capacity Blocks for ML. For more information, see `Amazon EC2 billing and purchasing options <https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-purchasing-options.html>`__ in the *Amazon Elastic Compute Cloud User Guide*. For more information about PCS support for Capacity Blocks, see `Using Amazon EC2 Capacity Blocks for ML with PCS <https://docs.aws.amazon.com/pcs/latest/userguide/capacity-blocks.html>`__ in the *PCS User Guide*. If you don't provide this option, it defaults to On-Demand.

          
        

        - **customLaunchTemplate** *(dict) --* 

          An Amazon EC2 launch template PCS uses to launch compute nodes.

          
          

          - **id** *(string) --* 

            The ID of the EC2 launch template to use to provision instances.

             

            Example: ``lt-xxxx``

            
          

          - **version** *(string) --* 

            The version of the EC2 launch template to use to provision instances.

            
      
        

        - **iamInstanceProfileArn** *(string) --* 

          The Amazon Resource Name (ARN) of the IAM instance profile used to pass an IAM role when launching EC2 instances. The role contained in your instance profile must have the ``pcs:RegisterComputeNodeGroupInstance`` permission and the role name must start with ``AWSPCS`` or must have the path ``/aws-pcs/``. For more information, see `IAM instance profiles for PCS <https://docs.aws.amazon.com/pcs/latest/userguide/security-instance-profiles.html>`__ in the *PCS User Guide*.

          
        

        - **scalingConfiguration** *(dict) --* 

          Specifies the boundaries of the compute node group auto scaling.

          
          

          - **minInstanceCount** *(integer) --* 

            The lower bound of the number of instances allowed in the compute fleet.

            
          

          - **maxInstanceCount** *(integer) --* 

            The upper bound of the number of instances allowed in the compute fleet.

            
      
        

        - **instanceConfigs** *(list) --* 

          A list of EC2 instance configurations that PCS can provision in the compute node group.

          
          

          - *(dict) --* 

            An EC2 instance configuration PCS uses to launch compute nodes.

            
            

            - **instanceType** *(string) --* 

              The EC2 instance type that PCS can provision in the compute node group.

               

              Example: ``t2.xlarge``

              
        
      
        

        - **spotOptions** *(dict) --* 

          Additional configuration when you specify ``SPOT`` as the ``purchaseOption`` for the ``CreateComputeNodeGroup`` API action.

          
          

          - **allocationStrategy** *(string) --* 

            The Amazon EC2 allocation strategy PCS uses to provision EC2 instances. PCS supports **lowest price**, **capacity optimized**, and **price capacity optimized**. For more information, see `Use allocation strategies to determine how EC2 Fleet or Spot Fleet fulfills Spot and On-Demand capacity <https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/spot-fleet-allocation-strategy.html>`__ in the *Amazon Elastic Compute Cloud User Guide*. If you don't provide this option, it defaults to **price capacity optimized**.

            
      
        

        - **slurmConfiguration** *(dict) --* 

          Additional options related to the Slurm scheduler.

          
          

          - **slurmCustomSettings** *(list) --* 

            Additional Slurm-specific configuration that directly maps to Slurm settings.

            
            

            - *(dict) --* 

              Additional settings that directly map to Slurm settings.

               

              .. warning::

                 

                PCS supports a subset of Slurm settings. For more information, see `Configuring custom Slurm settings in PCS <https://docs.aws.amazon.com/pcs/latest/userguide/slurm-custom-settings.html>`__ in the *PCS User Guide*.

                

              
              

              - **parameterName** *(string) --* 

                PCS supports custom Slurm settings for clusters, compute node groups, and queues. For more information, see `Configuring custom Slurm settings in PCS <https://docs.aws.amazon.com/pcs/latest/userguide/slurm-custom-settings.html>`__ in the *PCS User Guide*.

                
              

              - **parameterValue** *(string) --* 

                The values for the configured Slurm settings.

                
          
        
      
        

        - **errorInfo** *(list) --* 

          The list of errors that occurred during compute node group provisioning.

          
          

          - *(dict) --* 

            An error that occurred during resource creation.

            
            

            - **code** *(string) --* 

              The short-form error code.

              
            

            - **message** *(string) --* 

              The detailed error information.

              
        
      
    
  
  **Exceptions**
  
  *   :py:class:`ParallelComputingService.Client.exceptions.ServiceQuotaExceededException`

  
  *   :py:class:`ParallelComputingService.Client.exceptions.ThrottlingException`

  
  *   :py:class:`ParallelComputingService.Client.exceptions.ValidationException`

  
  *   :py:class:`ParallelComputingService.Client.exceptions.ConflictException`

  
  *   :py:class:`ParallelComputingService.Client.exceptions.ResourceNotFoundException`

  
  *   :py:class:`ParallelComputingService.Client.exceptions.InternalServerException`

  
  *   :py:class:`ParallelComputingService.Client.exceptions.AccessDeniedException`

  