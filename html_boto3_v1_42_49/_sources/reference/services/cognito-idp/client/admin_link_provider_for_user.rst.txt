:doc:`CognitoIdentityProvider <../../cognito-idp>` / Client / admin_link_provider_for_user

****************************
admin_link_provider_for_user
****************************



.. py:method:: CognitoIdentityProvider.Client.admin_link_provider_for_user(**kwargs)

  

  Links an existing user account in a user pool, or ``DestinationUser``, to an identity from an external IdP, or ``SourceUser``, based on a specified attribute name and value from the external IdP.

   

  This operation connects a local user profile with a user identity who hasn't yet signed in from their third-party IdP. When the user signs in with their IdP, they get access-control configuration from the local user profile. Linked local users can also sign in with SDK-based API operations like ``InitiateAuth`` after they sign in at least once through their IdP. For more information, see `Linking federated users <https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-identity-federation-consolidate-users.html>`__.

   

  .. note::

    

    The maximum number of federated identities linked to a user is five.

    

   

  .. warning::

     

    Because this API allows a user with an external federated identity to sign in as a local user, it is critical that it only be used with external IdPs and linked attributes that you trust.

     

   

  .. note::

    

    Amazon Cognito evaluates Identity and Access Management (IAM) policies in requests for this API operation. For this operation, you must use IAM credentials to authorize requests, and you must grant yourself the corresponding IAM permission in a policy.

     

    **Learn more**

     

    
    * `Signing Amazon Web Services API Requests <https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_aws-signing.html>`__
     
    * `Using the Amazon Cognito user pools API and user pool endpoints <https://docs.aws.amazon.com/cognito/latest/developerguide/user-pools-API-operations.html>`__
    

    

  

  See also: `AWS API Documentation <https://docs.aws.amazon.com/goto/WebAPI/cognito-idp-2016-04-18/AdminLinkProviderForUser>`_  


  **Request Syntax**
  ::

    response = client.admin_link_provider_for_user(
        UserPoolId='string',
        DestinationUser={
            'ProviderName': 'string',
            'ProviderAttributeName': 'string',
            'ProviderAttributeValue': 'string'
        },
        SourceUser={
            'ProviderName': 'string',
            'ProviderAttributeName': 'string',
            'ProviderAttributeValue': 'string'
        }
    )
    
  :type UserPoolId: string
  :param UserPoolId: **[REQUIRED]** 

    The ID of the user pool where you want to link a federated identity.

    

  
  :type DestinationUser: dict
  :param DestinationUser: **[REQUIRED]** 

    The existing user in the user pool that you want to assign to the external IdP user account. This user can be a local (Username + Password) Amazon Cognito user pools user or a federated user (for example, a SAML or Facebook user). If the user doesn't exist, Amazon Cognito generates an exception. Amazon Cognito returns this user when the new user (with the linked IdP attribute) signs in.

     

    For a native username + password user, the ``ProviderAttributeValue`` for the ``DestinationUser`` should be the username in the user pool. For a federated user, it should be the provider-specific ``user_id``.

     

    The ``ProviderAttributeName`` of the ``DestinationUser`` is ignored.

     

    The ``ProviderName`` should be set to ``Cognito`` for users in Cognito user pools.

     

    .. warning::

       

      All attributes in the DestinationUser profile must be mutable. If you have assigned the user any immutable custom attributes, the operation won't succeed.

      

    

  
    - **ProviderName** *(string) --* 

      The name of the provider, such as Facebook, Google, or Login with Amazon.

      

    
    - **ProviderAttributeName** *(string) --* 

      The name of the provider attribute to link to, such as ``NameID``.

      

    
    - **ProviderAttributeValue** *(string) --* 

      The value of the provider attribute to link to, such as ``xxxxx_account``.

      

    
  
  :type SourceUser: dict
  :param SourceUser: **[REQUIRED]** 

    An external IdP account for a user who doesn't exist yet in the user pool. This user must be a federated user (for example, a SAML or Facebook user), not another native user.

     

    If the ``SourceUser`` is using a federated social IdP, such as Facebook, Google, or Login with Amazon, you must set the ``ProviderAttributeName`` to ``Cognito_Subject``. For social IdPs, the ``ProviderName`` will be ``Facebook``, ``Google``, or ``LoginWithAmazon``, and Amazon Cognito will automatically parse the Facebook, Google, and Login with Amazon tokens for ``id``, ``sub``, and ``user_id``, respectively. The ``ProviderAttributeValue`` for the user must be the same value as the ``id``, ``sub``, or ``user_id`` value found in the social IdP token.

     

    For OIDC, the ``ProviderAttributeName`` can be any mapped value from a claim in the ID token, or that your app retrieves from the ``userInfo`` endpoint. For SAML, the ``ProviderAttributeName`` can be any mapped value from a claim in the SAML assertion.

     

    The following additional considerations apply to ``SourceUser`` for OIDC and SAML providers.

     

    
    * You must map the claim to a user pool attribute in your IdP configuration, and set the user pool attribute name as the value of ``ProviderAttributeName`` in your ``AdminLinkProviderForUser`` request. For example, ``email``.
     
    * When you set ``ProviderAttributeName`` to ``Cognito_Subject``, Amazon Cognito will automatically parse the default unique identifier found in the subject from the IdP token.
    

    

  
    - **ProviderName** *(string) --* 

      The name of the provider, such as Facebook, Google, or Login with Amazon.

      

    
    - **ProviderAttributeName** *(string) --* 

      The name of the provider attribute to link to, such as ``NameID``.

      

    
    - **ProviderAttributeValue** *(string) --* 

      The value of the provider attribute to link to, such as ``xxxxx_account``.

      

    
  
  
  :rtype: dict
  :returns: 
    
    **Response Syntax**

    
    ::

      {}
      
    **Response Structure**

    

    - *(dict) --* 
  
  **Exceptions**
  
  *   :py:class:`CognitoIdentityProvider.Client.exceptions.ResourceNotFoundException`

  
  *   :py:class:`CognitoIdentityProvider.Client.exceptions.InvalidParameterException`

  
  *   :py:class:`CognitoIdentityProvider.Client.exceptions.TooManyRequestsException`

  
  *   :py:class:`CognitoIdentityProvider.Client.exceptions.NotAuthorizedException`

  
  *   :py:class:`CognitoIdentityProvider.Client.exceptions.UserNotFoundException`

  
  *   :py:class:`CognitoIdentityProvider.Client.exceptions.AliasExistsException`

  
  *   :py:class:`CognitoIdentityProvider.Client.exceptions.LimitExceededException`

  
  *   :py:class:`CognitoIdentityProvider.Client.exceptions.InternalErrorException`

  